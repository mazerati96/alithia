<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Collaborator Dashboard â€” Alithia</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cormorant+Garamond:ital,wght@0,300;1,300&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../css/navigation.css" />
    <link rel="stylesheet" href="../css/dashboard.css" />
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div class="vignette"></div>

    <div class="hamburger-menu" id="hamburger">
        <span></span><span></span><span></span>
    </div>

    <div class="nav-overlay" id="navOverlay">
        <ul class="nav-menu">
            <li><a href="worldmap.html">WORLD MAP</a></li>
            <li><a href="lore.html">LORE CODEX</a></li>
            <li><a href="factions.html">FACTIONS</a></li>
            <li><a href="characters.html">CHARACTERS</a></li>
            <li><a href="updates.html">UPDATES</a></li>
            <li><a href="dashboard.html" class="active">DASHBOARD</a></li>
        </ul>
    </div>

    <div class="page-transition"></div>

    <div class="auth-guard" id="authGuard">
        <div class="auth-guard-inner">
            <div class="guard-rune">áš±</div>
            <p>Verifying your passageâ€¦</p>
        </div>
    </div>

    <div class="dashboard-wrap hidden" id="dashboardWrap">

        <header class="dash-topbar">
            <div class="dash-topbar-left">
                <a href="worldmap.html" class="topbar-home"><span class="topbar-glyph">âœ¦</span> Alithia</a>
                <span class="topbar-divider">|</span>
                <span class="topbar-label">Collaborator Dashboard</span>
            </div>
            <div class="dash-topbar-right">
                <button class="topbar-icon-btn" id="searchBtn" title="Search the chronicle">âŒ•</button>
                <span class="topbar-username" id="topbarUsername">â€”</span>
                <span class="notif-dot hidden" id="notifDot" title="New updates since your last visit"></span>
                <button class="signout-btn" id="signOutBtn">Sign Out</button>
            </div>
        </header>

        <div class="dash-body">

            <!-- LEFT: Feed -->
            <section class="dash-feed">

                <div class="feed-header">
                    <h2 class="feed-title">Collaborator Updates</h2>
                    <div class="feed-subtitle">What's happening in Alithia</div>
                </div>

                <!-- Author chips -->
                <div class="filter-bar" id="filterBar">
                    <button class="filter-chip active" data-uid="all">All Updates</button>
                </div>

                <!-- Category chips -->
                <div class="filter-bar category-bar" id="categoryBar">
                    <span class="filter-label">Category:</span>
                    <button class="filter-chip cat-chip active" data-cat="all">All</button>
                    <button class="filter-chip cat-chip" data-cat="lore">ðŸ“œ Lore</button>
                    <button class="filter-chip cat-chip" data-cat="character">ðŸ‘¤ Character</button>
                    <button class="filter-chip cat-chip" data-cat="map">ðŸ—º Map</button>
                    <button class="filter-chip cat-chip" data-cat="mechanics">âš™ Mechanics</button>
                    <button class="filter-chip cat-chip" data-cat="misc">âœ¦ Misc</button>
                </div>

                <!-- Keeper announcements -->
                <div class="announcements-section" id="announcementsSection">
                    <div class="announcements-header">
                        <span class="announce-icon">ðŸ“Œ</span>
                        <span class="announce-title">Keeper's Announcements</span>
                        <button class="announce-add-btn hidden" id="announceAddBtn">+ Pin</button>
                    </div>
                    <div class="announce-composer hidden" id="announceComposer">
                        <textarea id="announceContent" class="composer-textarea"
                                  placeholder="Pin an announcement for all collaboratorsâ€¦"
                                  maxlength="600" rows="2"></textarea>
                        <div class="composer-footer">
                            <button class="post-btn" id="announcePostBtn">Pin It</button>
                            <button class="card-action-btn cancel-btn" id="announceCancelBtn">Cancel</button>
                        </div>
                    </div>
                    <div id="announceList"></div>
                </div>

                <!-- Composer -->
                <div class="composer" id="composer">
                    <div class="composer-header">
                        <span class="composer-avatar" id="composerAvatar">?</span>
                        <span class="composer-name" id="composerName">â€”</span>
                        <select class="category-select" id="postCategory">
                            <option value="misc">âœ¦ Misc</option>
                            <option value="lore">ðŸ“œ Lore</option>
                            <option value="character">ðŸ‘¤ Character</option>
                            <option value="map">ðŸ—º Map</option>
                            <option value="mechanics">âš™ Mechanics</option>
                        </select>
                    </div>
                    <textarea id="postContent" class="composer-textarea"
                              placeholder="Share a progress update, lore note, or world-building thoughtâ€¦"
                              maxlength="1000" rows="3"></textarea>
                    <div class="composer-footer">
                        <span class="char-count" id="charCount">0 / 1000</span>
                        <button class="post-btn" id="postBtn">Post Update</button>
                    </div>
                </div>

                <!-- Feed -->
                <div class="feed-list" id="feedList">
                    <div class="feed-loading" id="feedLoading">
                        <span class="loading-rune">áš </span>
                        <span>Loading the chronicleâ€¦</span>
                    </div>
                </div>

            </section>

            <!-- RIGHT: Sidebar -->
            <aside class="dash-sidebar">

                <!-- Profile -->
                <div class="sidebar-card profile-card">
                    <div class="profile-avatar" id="profileAvatar">?</div>
                    <div class="profile-name" id="profileName">â€”</div>
                    <div class="profile-role" id="profileRole">Collaborator</div>
                    <div class="profile-since" id="profileSince">â€”</div>
                    <button class="edit-profile-btn" id="editProfileBtn">âœŽ Edit Profile</button>
                </div>

                <!-- Stats -->
                <div class="sidebar-card stats-card">
                    <div class="card-label">Your Contributions</div>
                    <div class="stats-row">
                        <div class="stat">
                            <div class="stat-value" id="statPosts">â€”</div>
                            <div class="stat-label">Updates Posted</div>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat">
                            <div class="stat-value" id="statDays">â€”</div>
                            <div class="stat-label">Days Active</div>
                        </div>
                    </div>
                </div>

                <!-- Lore Claims -->
                <div class="sidebar-card claims-card">
                    <div class="card-label">Lore Claims</div>
                    <div class="claims-list" id="claimsList">
                        <div class="collab-loading">Loading claimsâ€¦</div>
                    </div>
                    <button class="post-btn claims-add-btn" id="claimsAddBtn">+ Claim a Topic</button>
                </div>

                <!-- Quick links -->
                <div class="sidebar-card links-card">
                    <div class="card-label">Quick Navigation</div>
                    <nav class="quick-links">
                        <a href="worldmap.html" class="quick-link">
                            <span class="ql-icon">ðŸ—º</span><span>World Map</span><span class="ql-arrow">â†’</span>
                        </a>
                        <a href="lore.html" class="quick-link">
                            <span class="ql-icon">ðŸ“œ</span><span>Lore Codex</span><span class="ql-arrow">â†’</span>
                        </a>
                        <a href="factions.html" class="quick-link">
                            <span class="ql-icon">âš”</span><span>Factions</span><span class="ql-arrow">â†’</span>
                        </a>
                        <a href="characters.html" class="quick-link">
                            <span class="ql-icon">ðŸ‘¤</span><span>Characters</span><span class="ql-arrow">â†’</span>
                        </a>
                        <a href="changelog.html" class="quick-link">
                            <span class="ql-icon">ðŸ“‹</span><span>Changelog</span><span class="ql-arrow">â†’</span>
                        </a>
                    </nav>
                </div>

                <!-- Collaborators -->
                <div class="sidebar-card collab-card">
                    <div class="card-label">The Collaboration â€” <span id="collabCount">0</span> members</div>
                    <div class="collab-list" id="collabList">
                        <div class="collab-loading">Gathering the scribesâ€¦</div>
                    </div>
                </div>

            </aside>
        </div>
    </div>

    <!-- Collaborator profile modal -->
    <div class="modal-backdrop hidden" id="profileModalBackdrop">
        <div class="modal-box" id="profileModal">
            <button class="modal-close" id="modalClose">âœ•</button>
            <div class="modal-avatar" id="modalAvatar">?</div>
            <div class="modal-name" id="modalName">â€”</div>
            <div class="modal-role" id="modalRoleDisplay">Collaborator</div>
            <div class="modal-meta">
                <span id="modalPosts">â€”</span>
                <span class="modal-meta-dot">Â·</span>
                <span id="modalJoined">â€”</span>
            </div>
            <div class="modal-divider"></div>
            <div class="modal-section-label">Recent Updates</div>
            <div class="modal-list" id="modalRecentList"></div>
            <button class="modal-filter-btn" id="modalFilterBtn">View All Their Updates â†’</button>
        </div>
    </div>

    <!-- Edit profile modal -->
    <div class="modal-backdrop hidden" id="editProfileBackdrop">
        <div class="modal-box">
            <button class="modal-close" id="editProfileClose">âœ•</button>
            <div class="modal-avatar" id="editProfileAvatar">?</div>
            <div class="modal-section-label" style="align-self:flex-start">Edit Your Profile</div>
            <div class="modal-form">
                <label class="modal-label">Display Name</label>
                <input type="text" class="modal-input" id="editNameInput"
                       placeholder="Your collaborator name" maxlength="40" />
                <div class="form-message" id="editProfileMsg"></div>
                <button class="post-btn" id="editProfileSave" style="width:100%;margin-top:0.5rem">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Claim topic modal -->
    <div class="modal-backdrop hidden" id="claimModalBackdrop">
        <div class="modal-box">
            <button class="modal-close" id="claimModalClose">âœ•</button>
            <div class="modal-section-label" style="align-self:flex-start">Claim a Lore Topic</div>
            <p class="modal-hint">Signal to the team that you're actively writing this. Be specific.</p>
            <div class="modal-form">
                <label class="modal-label">Topic Name</label>
                <input type="text" class="modal-input" id="claimTopicInput"
                       placeholder="e.g. Narithrem history" maxlength="60" />
                <label class="modal-label" style="margin-top:0.75rem">Category</label>
                <select class="modal-input category-select" id="claimCategorySelect">
                    <option value="region">Region</option>
                    <option value="faction">Faction</option>
                    <option value="character">Character</option>
                    <option value="lore">General Lore</option>
                    <option value="other">Other</option>
                </select>
                <div class="form-message" id="claimMsg"></div>
                <button class="post-btn" id="claimSubmitBtn" style="width:100%;margin-top:0.75rem">Claim Topic</button>
            </div>
        </div>
    </div>

    <!-- Search overlay -->
    <div class="search-overlay hidden" id="searchOverlay">
        <div class="search-inner">
            <div class="search-bar-wrap">
                <span class="search-icon">âŒ•</span>
                <input type="text" class="search-input" id="searchInput"
                       placeholder="Search updates, announcements, claimsâ€¦" autocomplete="off" />
                <button class="modal-close search-close" id="searchClose">âœ•</button>
            </div>
            <div class="search-results" id="searchResults">
                <div class="search-hint">Start typing to search the chronicleâ€¦</div>
            </div>
        </div>
    </div>

    <script src="../js/navigation.js"></script>
    <script type="module" src="../js/dashboard.js"></script>
</body>
</html>